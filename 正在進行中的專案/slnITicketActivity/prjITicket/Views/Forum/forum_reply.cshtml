@*<script src="~/Content/js/scripts.js"></script>*@
@using prjITicket.Models;
@using prjITicket.ViewModel
@model VMReport
@{

    int count = 0;
}


<!-- Single Comment -->
@*<script src="~/Content/Forum_use/js/jquery-3.5.1.min.js"></script>*@

<link href="~/Content/Forum_use/forumcontent.css" rel="stylesheet" />
<link href="~/Content/Forum_use/css/styles.css" rel="stylesheet" />
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
@foreach (var item in Model.Article.Reply)
{


    <div class="media mb-4">
        <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
        <div class="media-body">
            <div class="float-right">
                <button class="btn" data-toggle="collapse" href=#CollapseDemo@(count) role="button" aria-expanded="false" aria-controls="CollapseDemo@(count)"><i class="fa fa-bars"></i></button>
            </div>

            <h5 class="mt-0">@item.Member.Name</h5>
            <div id="replyshow">
                <p id="replyshow_content_@(item.ReplyID)">@(item.ReplyContent)</p>
                <input onkeydown="txtReplyKeyDown(@item.ReplyID)" id="replyEdit_content_@(item.ReplyID)" name="@(item.ReplyID)" type="text" style="width:600px;display:none;" rows="1" value="@(item.ReplyContent)">
                <p id="fnt_@(item.ReplyID)" style="display:none;font-size:13px;color:gray">
                    修改完成後按
                    <span style="color:blue">Enter</span>修改或是
                    <span style="color:blue">Esc</span>取消
                </p>

            </div>

            <div class="row">
                <div class="col">
                    <div class="collapse multi-collapse" id="CollapseDemo@(count)">
                        <div class="card card-body">
                            <div class="col-xs-5">
                                <button class="gp">👍</button>
                                <button class="bp">👎</button>
                                <button class="emotion info" onclick="showModal(@count)">檢舉</button>
                                <button onclick="toggleEdit(@item.ReplyID)" class="emotion info">編輯留言</button>
                                @*改天把刪除也改成按鈕*@
                                <button onclick="replydelete(@item.ReplyID)" class="emotion info">刪除留言</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="display:none" id="Modal@(count)" class="w3-modal w3-animate-opacity">
        <div class="w3-modal-content">
            <header class="w3-container w3-teal">
                <span onclick="closeModal(@count)" class="w3-button w3-display-topright">&times;</span>
                <h3>檢舉留言</h3>
            </header>
            <div class="w3-container">
                <br />
                <span>請選擇檢舉理由：</span>
                <select id="reason">
                    <option value="#">請選擇理由</option>
                    @foreach (var q in Model.Report)
                    {

                        <option value="@q.ReportId">@q.ReportReason</option>

                    }
                </select>
                <p style=" margin-top:3px;font-size:12px;color:darkgray">
                    人身攻擊、侵犯個人隱私、著作權限當事人檢舉。
                    惡意檢舉，經查證屬實將依站規處分。.
                </p>
            </div>
            <footer class="w3-container w3-teal">
                <div style="margin:5px 0px;" class="float-right">
                    <button class="w3-button w3-black" type="button" onclick="closeModal(@count)">取消</button>
                    <button class="w3-button w3-pale-green" type="button" onclick="reportReason(@item.ReplyID)">確定</button>
                </div>
            </footer>
        </div>
    </div>


    count += 1;


}

<script>




    function replydelete(replyId) {
        $.ajax({
                    type: "post",
                    url: "@Url.Action("Reply_Delete")",
                    data: { replyId: replyId ,ArticleID:@Model.Article.ArticleID},
            success: function (data) {
                        alert(data)
                        $("#ajaxdemoshow").load(`/Forum/forum_reply?articleID=@Model.Article.ArticleID`);
                    }
                });
    }

    function txtReplyKeyDown(replyId) {

        if (window.event.keyCode == 13) {
            let rpcontent = $("#replyEdit_content_"+`${replyId}`).val();

            if (rpcontent == "")
            {
                alert("請輸入留言");
            }
            else
            {
                $.ajax({
                    type: "post",
                    url: "@Url.Action("Reply_Edit")",
                    data: { rpcontent: rpcontent, replyId: replyId },
                    success: function (data) {
                        alert("成功")
                        $("#ajaxdemoshow").load(`/Forum/forum_reply?articleID=@Model.Article.ArticleID`);
                    }
                });
            }
        }
        if(window.event.keyCode == 27){
            let x = document.getElementById("replyEdit_content_" + replyId);
            let y = document.getElementById("replyshow_content_" + replyId);
            let z = document.getElementById("fnt_" + replyId);

            x.style.display = 'none';
            y.style.display = 'block';
            z.style.display = 'none';
           }
    }
    function toggleEdit(replyId) {
        let x = document.getElementById("replyEdit_content_" + replyId);
        let y = document.getElementById("replyshow_content_" + replyId);
        let z = document.getElementById("fnt_" + replyId);
        if (x.style.display === 'none') {
               x.style.display = 'block';
               y.style.display = 'none';
               z.style.display = 'block';
           } else {
               x.style.display = 'none';
               y.style.display = 'block';
               z.style.display = 'none';
           }
    }

    function showModal(count) {
        let Modal = document.getElementById('Modal' + count);
        Modal.style.display = 'block';
    }

    function closeModal(count) {
        let Modal = document.getElementById('Modal' + count);
        Modal.style.display = 'none';
    }

    function reportReason(replyId) {
        let reportId = $('#reason').val();
        if (reportId === '#') {
            alert("社會再走，理由要有");
        }
        else {
         $.ajax({
            type: "post",
             url: "@Url.Action("Reply_Report")",
             data: {
                 ReportID: reportId, ReplyID: replyId},
        success: function (data) {
            alert("檢舉" + data);
        }
      });
    }
    }
</script>

