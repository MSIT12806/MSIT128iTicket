<script src="~/Content/js/scripts.js"></script>

@model prjITicket.Models.Article
@{

    int count = 0;
}


<!-- Single Comment -->
<script src="~/Content/js/jquery-3.5.1.min.js"></script>
<link href="~/css/styles.css" rel="stylesheet" />
<link href="~/Content/css/forumcontent.css" rel="stylesheet" />
@foreach (var item in Model.Reply)
{


    <div class="media mb-4">
        <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
        <div class="media-body">
            <div class="float-right">
                <button class="btn" data-toggle="collapse" href=#CollapseDemo@(count) role="button" aria-expanded="false" aria-controls="CollapseDemo@(count)"><i class="fa fa-bars"></i></button>
            </div>

            <h5 class="mt-0">@item.Member.Name</h5>
            <div id="replyshow">
                <p id="replyshow_content_@(item.ReplyID)">@(item.ReplyContent)</p>
                <input onkeydown="txtReplyKeyDown(@item.ReplyID)" id="replyEdit_content_@(item.ReplyID)" name="@(item.ReplyID)" type="text" style="width:600px;display:none;" rows="1" value="@(item.ReplyContent)">
                <p id="fnt_@(item.ReplyID)" style="display:none;font-size:13px;color:gray">
                    修改完成後按
                    <span style="color:blue">Enter</span>修改或是
                    <span style="color:blue">Esc</span>取消
                </p>

            </div>

            <div class="row">
                <div class="col">
                    <div class="collapse multi-collapse" id="CollapseDemo@(count)">
                        <div class="card card-body">
                            <div class="col-xs-5">
                                <button class="emotion info">推</button>
                                <button class="emotion info">噓</button>
                                <button class="emotion info">檢舉</button>
                                <button onclick="toggleEdit(@item.ReplyID)" class="emotion info">編輯留言</button>
                                @*改天把刪除也改成按鈕*@
                                <button onclick="replydelete(@item.ReplyID)" class="emotion info">刪除留言</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    count += 1;
}

<script>




    function replydelete(replyId) {
        $.ajax({
                    type: "post",
                    url: "@Url.Action("Reply_Delete")",
                    data: { replyId: replyId ,ArticleID:@Model.ArticleID},
            success: function (data) {
                        
                        $("#ajaxdemoshow").load(`/Forum/forum_reply?articleID=@Model.ArticleID`);
                    }
                });
    }

    function txtReplyKeyDown(replyId) {

        if (window.event.keyCode == 13) {
            let rpcontent = $("#replyEdit_content_"+`${replyId}`).val();

            if (rpcontent == "")
            {
                alert("請輸入留言");
            }
            else
            {
                $.ajax({
                    type: "post",
                    url: "@Url.Action("Reply_Edit")",
                    data: { rpcontent: rpcontent, replyId: replyId },
                    success: function (data) {
                        alert("成功")
                        $("#ajaxdemoshow").load(`/Forum/forum_reply?articleID=@Model.ArticleID`);
                    }
                });
            }
        }
        if(window.event.keyCode == 27){
            let x = document.getElementById("replyEdit_content_" + replyId);
            let y = document.getElementById("replyshow_content_" + replyId);
            let z = document.getElementById("fnt_" + replyId);

            x.style.display = 'none';
            y.style.display = 'block';
            z.style.display = 'none';
           }
    }
    function toggleEdit(replyId) {
        let x = document.getElementById("replyEdit_content_" + replyId);
        let y = document.getElementById("replyshow_content_" + replyId);
        let z = document.getElementById("fnt_" + replyId);
        if (x.style.display === 'none') {
               x.style.display = 'block';
               y.style.display = 'none';
               z.style.display = 'block';
           } else {
               x.style.display = 'none';
               y.style.display = 'block';
               z.style.display = 'none';
           }
    }
</script>

